diff --git a/setup.py b/setup.py
index de9bbea9..46ffdcbc 100755
--- a/setup.py
+++ b/setup.py
@@ -32,7 +32,7 @@ RUN_REQUIRES = [NUMPY_DEP, 'six']
 # these are required to build h5py
 # RUN_REQUIRES is included as setup.py test needs RUN_REQUIRES for testing
 # RUN_REQUIRES can be removed when setup.py test is removed
-SETUP_REQUIRES = RUN_REQUIRES + [NUMPY_DEP, 'Cython>=0.23', 'pkgconfig']
+SETUP_REQUIRES = []  # Chaquopy: handled by meta.yaml
 
 # Needed to avoid trying to install numpy/cython on pythons which the latest
 # versions don't support
diff --git a/setup_build.py b/setup_build.py
index c0e9a28c..4c8755f8 100644
--- a/setup_build.py
+++ b/setup_build.py
@@ -78,7 +78,6 @@ class h5py_build_ext(build_ext):
         This is the point at which custom directories, MPI options, etc.
         enter the build process.
         """
-        import numpy
         import pkgconfig
 
         settings = COMPILER_SETTINGS.copy()
@@ -103,12 +102,8 @@ class h5py_build_ext(build_ext):
             settings['include_dirs'].extend(FALLBACK_PATHS['include_dirs'])
             settings['library_dirs'].extend(FALLBACK_PATHS['library_dirs'])
 
-        try:
-            numpy_includes = numpy.get_include()
-        except AttributeError:
-            # if numpy is not installed get the headers from the .egg directory
-            import numpy.core
-            numpy_includes = os.path.join(os.path.dirname(numpy.core.__file__), 'include')
+        # Chaquopy
+        numpy_includes = os.path.abspath("../requirements/numpy/core/include")
 
         settings['include_dirs'] += [numpy_includes]
         if config.mpi:
@@ -159,7 +154,6 @@ class h5py_build_ext(build_ext):
         """ Distutils calls this method to run the command """
 
         from Cython.Build import cythonize
-        import numpy
 
         # Provides all of our build options
         config = self.distribution.get_command_obj('configure')
@@ -197,7 +191,9 @@ DEF COMPLEX256_SUPPORT = %(complex256_support)s
                     'mpi': bool(config.mpi),
                     'mpi4py_v2': bool(v2),
                     'version': tuple(int(x) for x in config.hdf5_version.split('.')),
-                    'complex256_support': hasattr(numpy, 'complex256')
+                    # Chaquopy: was `hasattr(numpy, 'complex256')`: erring on the side of caution.
+                    # TODO: see if there's another way to detect this.
+                    'complex256_support': False
                 }
                 s = s.encode('utf-8')
                 f.write(s)
diff --git a/setup_configure.py b/setup_configure.py
index 5576775e..84f6c97c 100644
--- a/setup_configure.py
+++ b/setup_configure.py
@@ -90,7 +90,7 @@ class configure(Command):
                     ('reset', 'r', 'Reset config options') ]
 
     def initialize_options(self):
-        self.hdf5 = None
+        self.hdf5 = op.abspath("../requirements/chaquopy")
         self.hdf5_version = None
         self.mpi = None
         self.reset = None
@@ -195,6 +195,13 @@ def autodetect_version(hdf5_dir=None):
 
     import pkgconfig
 
+    # Chaquopy: added
+    for line in open(op.join(hdf5_dir, "include/H5public.h")):
+        match = re.search(r"HDF5 library version: ([0-9.]+)", line)
+        if match:
+            return match.group(1)
+    raise ValueError("Failed to find version string in header files")
+    
     if sys.platform.startswith('darwin'):
         default_path = 'libhdf5.dylib'
         regexp = re.compile(r'^libhdf5.dylib')
